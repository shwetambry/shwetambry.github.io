<?php
session_start();

if(!empty($_REQUEST['form_products']))
{
	if(!isset($_SESSION['products']))
	{
		print "<p> Registering the products session variable </p>";
		print "<p> Adding the first product. </p>";
		print "Got ".$_REQUEST['form_products']. " from form.<br> ";
		$_SESSION['products'][0] = $_REQUEST['form_products'];
		$_SESSION['quantity'][0] = $_REQUEST['quantity'];
		$_SESSION['id'][0] = $_REQUEST['prodId'];
		print "Added ".$_REQUEST['form_products']. " to session<br>";
		$_SESSION['prodPrice'][0] = $_REQUEST['form_prod_price']; 
		
	}
	else
	{
		$newProdID = $_REQUEST['prodId'];
		print "<p> Adding a new product to the list. </p>";
		print "Got $_REQUEST['form_products'] from form.<br> ";
		$match = false;
		for ($i=0; $i < sizeof($_SESSION['products']; $i++))
		{
			if($newProdID == $_SESSION['id'][$i])
			{
				$_SESSION['quantity'][$i]+=$_REQUEST['quantity'];
				$match = true;				
				break;
			}
		}	
		if(!$match)
		{
			$_SESSION['products'][] = $_REQUEST['form_products'];
			$_SESSION['prodPrice'][] = $_REQUEST['form_prod_price']; 
			$_SESSION['id'][] = $newProdID;
			$_SESSION['quantity'][] = $_REQUEST['quantity']
			print "Added ".$_REQUEST['form_products']. " to session<br>";
		}
	}
	print "Number of products added to the cart = ";
	print sizeof($_SESSION['products'])."<br>";
	print "<b> Your cart : </b> ";
	print "<table> <tr> <td> Product </td> <td> Unit Price </td> <td> Quantity </td> <td> Total Price </td> ";
	$cartPrice = 0;
	for ($i=0;$i<sizeof($_SESSION['products']);$i++)
	{
		print "<tr> <td> $_SESSION['products'][$i]</td> ";
		print "<td> $_SESSION['prodPrice'][$i] </td>";
		print "<td> $_SESSION['quantity'][$i]</td>";
		$tmp = $_SESSION['prodPrice'][$i]*$_SESSION['quantity'][$i];
		print "<td> $tmp </td></tr>";
		$cartPrice += $tmp;
	}
	print "</table>";
	print "Total Price for current products = ";
	print $cartPrice. "<br>";
}
else
{
	print "No products to add <br> at the moment. <br>";
}

print "<a href = 'unreg.php'> Clear </a> <br> ";
print "<a href = 'checkout.php'> Checkout </a> ";

?>
